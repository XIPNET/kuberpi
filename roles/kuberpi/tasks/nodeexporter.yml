# tasks file for install prometheus node exporter
- name: Current Service Check
  stat:
    path: /etc/sysconfig/node_exporter
  register: node_exporter_present

- fail:
    msg: Ending this playbook. Node Exporter already installed
  when: node_exporter_present.stat.exists == True

- name: Retrieve and Unarchive Binary
  unarchive:
    src: https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-armv7.tar.gz
    dest: ~/
    remote_src: yes

- name: Move binary to /usr/sbin
  become: yes
  command: mv /home/pirate/node_exporter-0.18.1.linux-armv7/node_exporter /usr/sbin/node_exporter

- name: Create directory
  become: yes
  file:
    path: /etc/sysconfig
    state: directory

- name: Touch file
  become: yes
  file:
    path: /etc/sysconfig/node_exporter
    state: touch

- name: Copy systemd File
  become: yes
  template:
    src: templates/nodeexporter.service
    dest: /lib/systemd/system/nodeexporter.service

- name: Systemctl daemon-reload
  become: yes
  systemd:
    state: restarted
    daemon_reload: yes
    name: nodeexporter

- name: Enable nodeexporter service
  become: yes
  systemd:
    name: nodeexporter
    enabled: yes
    masked: no

